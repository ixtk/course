პროექტის ფაილები: https://github.com/ixtk/mail-starter

## Backend
შექმენით ახალი Express.js პროექტი. დააინსტალირეთ express, mongoose, cors, bcrypt და სხვა საჭირო/სასურველი ბიბლიოთეკები (cookie-parser, jsonwebtoken, express-session, connect-mongo...).

პროექტის აღწერის მიხედვით გადაწყვიტეთ რას დაამატებთ მონაცემთა ბაზაში, რა ტიპის კავშირს გამოიყენებთ.

* User-ს უნდა ჰქონდეს მინიმუმ ეს ორი ველი: `email` და `password`.
* Email-ს უნდა ჰქონდეს მინიმუმ ეს ექვსი ველი: `sender`, `recipients`, `subject`, `body`, `sentAt`, `archived`.

**Authentication სტრატეგიაში შეზღუდულები არ ხართ**. შეგიძლიათ სესიები გამოიყენოთ, JWT ტოკენი ან თუნდაც რომელიმე Auth provider ბიბლიოთეკა, თუ გესმით საჭირო საკითხები.

### GET /user/status
ამოწმებს მომხმარებლის loggedIn სტატუსს. თუ მომხმარებელი სისტემაში შესულია, აბრუნებს მომხმარებლის ძირითად ინფორმაციას (`email`, `_id`).

### POST /user/register
`req.body`-ში გადაეცემა `email` და `password`. არეგისტრირებს მომხმარებელს, ამატებს მონაცემთა ბაზაში. დარეგისტრირების შემდეგ მომხმარებელი ჩათვალეთ სისტემაში შესულად. აბრუნებს მომხმარებლის ძირითად ინფორმაციას (`email`, `_id`).

### POST /user/login
`req.body`-ში გადაეცემა `email` და `password`. მომხმარებელი შეყავს სისტემაში. აბრუნებს მომხმარებლის ძირითად ინფორმაციას (`email`, `_id`).

### DELETE /user/logout
მომხმარებელი გამოყავს სისტემიდან.

### POST /emails
`req.body`-ში გადაეცემა `recipients`, `subject` და `body`, სადაც `recipients` მძიმით გამოყოფილი იმეილების string-ია. ქმნის ახალ იმეილს და აბრუნებს ახალი იმეილის საჭირო ატრიბუტებს.

### GET /emails/c/:emailCategory
path-ში დინამიურ სეგმენტად გადაეცემა `emailCategory`. აბრუნებს გადაცემულ კატეგორიაში შენახულ იმეილებს. Inbox კატეგორიის მითითებისას ყველა ისეთი იმეილი უნდა დაბრუნდეს, რომელიც არ არის `archived`. დანარჩენი კატეგორიები სახელების მიხედვით. ეს endpoint უნდა აბრუნებდეს სორტირებულ იმეილებს - უახლესი იმეილები დასაწყისში.

### GET /emails/:emailId
path-ში დინამიურ სეგმენტად გადაეცემა `emailId`. აბრუნებს შესაბამის იმეილს. 

### PATCH /emails/:emailId
path-ში დინამიურ სეგმენტად გადაეცემა `emailId`. `req.body`-ში გადაეცემა archived - `true` ან `false`. ეს არის იმეილის დაარქივების endpoint. archived პარამეტრის მიხედვით უნდა განაახლოთ იმეილი და დააბრუნოთ განახლებული იმეილის საჭირო ატრიბუტები.

### DELETE /emails/:emailId

შლის კონკრეტულ იმეილს ბაზიდან, `emailId`-ის მიხედვით

**მნიშვნელოვანია**: იმეილის დაბრუნებამდე/შეცვლამდე აუცილებლად შეამოწმეთ არის თუ არა ავტორიზებული მომხმარებელი გამოგზავნი/მიმღები მომხმარებლების სიაში. სხვის ანგარიშში დამატებული იმეილის წაკითხვა/დაარქივება მომხმარებელს არ უნდა შეეძლოს.

მონაცემთა ბაზაში იმეილის reply ინახება როგორც ახალი იმეილი. სიმარტივისთვის არ გვაქვს რაიმე nested სტრუქტურა/კავშირი ორიგინალ იმეილთან.

![An email record in MongoDB Compass](/homework/descriptions/img-attachments/p-1.png)

## Frontend
შექმენით ახალი React.js პროექტი და დააინსტალირეთ ბიბლიოთეკები Formik, Yup, axios და react-router-dom (clsx ან სხვა ნებისმიერი ბიბლიოთეკაც შეგიძლიათ დაამატოთ). 

### Routes

```
/c/:emailCategory
/c/:emailCategory/:emailId
/compose
/login
/register
/* (not-found)
```

**ინტერფეისი, assets, ლოგიკა და სხვა მითითებები**: https://github.com/ixtk/mail-starter

* გვერდის დარეფრეშებისას, ავტორიზაციის სტატუსი უნდა შენარჩუნდეს, მომხმარებელი უნდა დარჩეს შესული/გამოსული. ავტორიზაციის state-ის მენეჯმენტისთვის გამოიყენეთ Context (სავალდებულოა).
* ნავიგაციის ყველა ლინკს სტილი უნდა შეეცვალოს active state-ის მიხედვით (`NavLink`)
* დაამატეთ 404 გვერდის (not found) და error-ების handler გვერდები
* თუ კონკრეტული იმეილი ან იმეილის კატეგორია არ მოიძებნა, გადაამისამართეთ მომხმარებელი 404 სტატუსის გვერდზე
* იმეილის დაარქივებისას/არქივიდან წაშლისას, შესაბამისად უნდა შეიცვალოს URL და იმეილის label. დაარქივებისას, გადაამისამართეთ მომხმარებელი archived URL-ზე, და label შეცვალეთ - "archived"
* თუ მომხმარებელი სისტემაში შესულია, `login/`register route-ებზე გადასვლისას გადაამისამართეთ `/c/inbox` მისამართზე
* თუ მომხმარებელი შესული არ არის, რომელიმე ProtectedRoute-ზე გადასვლისას გადაამისამართეთ `/login` გვერდზე
* თუ სესიას/ტოკენს ვადა გაუვიდა ისეთ სიტუაციაში, როცა მომხმარებელი სისტემაში შესულია, axios interceptor-ით გადაამისამართეთ `/login` გვერდზე
* ყველგან, სადაც ინფორმაციას ჩატვირთვას ელოდებით (სევერის პასუხის ლოდინისას), გამოიტანეთ loading ინდიკატორი - ტექსტი "Loading..." ან skeleton ანიმაცია

### Reply ფუნქცია

Reply ღილაკზე დაჭერისას, მომხმარებელი გადაამისამართეთ compose გვერდზე. ფორმის მნიშვნელობები შეავსეთ იმ იმეილის ინფორმაციით, რომელსაც უგზავნით reply-ს. ყოველ ჯერზე, როცა მომხმარებლი reply-ს დააჭერს Subject-ის წინ დაამატეთ `"Re: "`. Body-ში გამოიყენეთ ეს შაბლონი:

```
----
on <მეილი რომელსაც reply-ს ვუგზავნით.sentAt>, <მეილი რომელსაც reply-ს ვუგზავნით.email> wrote:


<მეილი რომელსაც reply-ს ვუგზავნით.body>
```

(ეს სტრუქტურა შეიძლება nested გახდეს - თუ reply-ს ახალ reply-ს ვუგზავნით.

Recipients ველში დაამატეთ იმეილის მიმღები მომხმარებლების სია, მძიმით გამოყოფილი. **მნიშვნელოვანია**, რომ reply-ის შედგენისას მიმღები გახდეს ორიგინალი იმეილის ავტორი და მიმღებები მაგრამ ავტორიზებული მომხმარებლის გამოკლებით.

### Frontend ვალიდაცია

ყველა ფორმის ველს დაამატეთ ვალიდაცია Yup-ის გამოყენებით:

* Email: უნდა იყოს ვალიდური იმეილი (შეგიძლიათ regex მოიძიოთ)
* Password: უნდა იყოს მინიმუმ 8 ასო
* Confirm password - მნიშვნელობა უნდა ემთხვეოდეს password-ს (მოიძიეთ `oneOf`, `ref`) 
* Email subject: მინიმუმ 3 ასო
* Email recipients: უნდა იყოს ვალიდური იმეილი ან იმეილების სია
* Email body: მინიმუმ 3 ასო

### დიზაინი და Responsivity

ამ პროექტში მხოლოდ საჭიროა მობილურის ეკრანის ზომაზე ნავიგაციის ლინკების ტექსტის მაგივრად გამოჩნდეს icon-ები. დიზაინში შეგიძლიათ სურვილის მიხედვით რაღაცეები შეცვალოთ, დაამატოთ. თუმცა უნდა შენარჩუნდეს layout-ის დახვეწილი დიზაინი და სტრუქტურა.

### Error handling
frontend-ში საჭიროა ყველა input-ის ვალიდაცია და სერვერიდან წამოსული რაიმე ერორის შემთხვევაში ფორმის სტატუსის განახლება (ნახეთ ინტერფეისის სურათები).

### Github
**Git & Github-ის გამოყენება სავალდებულოა**, პროექტის წერის პარალელურად. შექმენით ახალი Github repository. პატარ-პატარა ცვლილებების დამატებისას, გაუშვით `git commit`, `git push`. დავალების დასრულებისას გამოგზავნეთ Github repository-ის ლინკი.

**P.S. გამოიყენეთ .env ფაილი და დაამატეთ .env.sample**

ძალიან კარგი იქნება თუ ამ პროექტს თქვენი ინიციატივით დაამატებთ ფუნქციებს და გაუმჯობესებებს.

---

### დამატებითი მოთხოვნები

1. მეილების სიის და თითოეული მეილის ყველა გვერდზე დაამატეთ Delete ღილაკი (ნახეთ განახლებული ინტერფეისის სურათები). სიის გვერდზე delete ღილაკზე დაჭერისას მეილი უნდა წაიშალოს და სია ვიზუალურად განახლდეს. კონკრეტული მეილის გვერდზე delete ღილაკზე დაჭერისას მომხმარებელი გადაამისამართეთ საწყის გვერდზე
2. შეცვალეთ backend პროექტის სტრუქტურა: დაამატეთ Router-ები და controller-ები. თითოეული controller ფუნქცია აუცილებლად მოაქციეთ asyncHandler-ში და დაამატეთ გლობალური error handling middleware (ნახავთ გაკვეთილის მასალაში).
3. Backend-ში დაამატეთ verifySchema middleware და ყველა საჭირო route-ს დაუწერეთ სქემის ვალიდაცია (`req.body`)
4. დაამატეთ mongoose schema ვალიდაციები/შეზღუდვები თქვენს შექმნილ სქემებზე

როგორც აქამდე იყო აღწერაში, frontend-ში საჭიროა ყველა input-ის ვალიდაცია (Yup) და სერვერიდან წამოსული რაიმე ერორის შემთხვევაში ფორმის სტატუსის განახლება (ნახეთ ინტერფეისის სურათები). შეგიძლიათ გამოიყენოთ `error.message`, `error.response.data.message`.

### Trello

რადგან ამ პროექტს ბევრი მოთხოვნა აქვს, გირჩევთ [Trello](https://trello.com/)-ში შექმნათ board ამ დავალების სხვადასხვა ნაწილის ორგანიზებისთვის.